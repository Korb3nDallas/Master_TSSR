<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Subnetting - La M√©thode Ultime</title>
    <style>
        :root {
            --bg: #0f172a;
            --card: #1e293b;
            --text: #e2e8f0;
            --accent: #8b5cf6; /* Violet */
            --bit-on: #10b981; /* Vert */
            --bit-off: #475569; /* Gris */
            --red: #ef4444;
        }

        body { font-family: 'Segoe UI', monospace; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 50px; }
        
        /* Navigation (Bouton Accueil) */
        .home-btn { position:fixed; top:20px; right:20px; background:#334155; color:white; padding:8px 15px; text-decoration:none; border-radius:8px; border:1px solid #475569; font-family:sans-serif; font-weight:bold; z-index:999; transition:0.2s; }
        .home-btn:hover { background: var(--accent); border-color: var(--accent); }

        header { text-align: center; padding: 40px 20px; background: linear-gradient(to bottom, #1e1b4b, var(--bg)); border-bottom: 1px solid #334155; }
        h1 { margin: 0; font-size: 2.5rem; background: linear-gradient(90deg, #a78bfa, #3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        
        /* TABS */
        .tabs { display: flex; gap: 10px; justify-content: center; margin-bottom: 30px; }
        .tab-btn { background: var(--card); border: 1px solid #334155; color: #94a3b8; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-size: 1rem; transition: 0.3s; }
        .tab-btn.active { background: var(--accent); color: white; border-color: var(--accent); box-shadow: 0 0 15px rgba(139, 92, 246, 0.4); }
        
        .section { display: none; animation: fadeIn 0.4s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

        /* CARDS */
        .card { background: var(--card); padding: 25px; border-radius: 12px; border: 1px solid #334155; margin-bottom: 25px; }
        h2 { color: var(--accent); margin-top: 0; display:flex; align-items:center; gap:10px; }
        
        /* COURS STYLES */
        .magic-rule { background: rgba(139, 92, 246, 0.1); border-left: 4px solid var(--accent); padding: 15px; margin: 15px 0; }
        .highlight { color: #38bdf8; font-weight: bold; }
        .calc-box { font-family: 'Consolas', monospace; background: #000; padding: 15px; border-radius: 6px; color: #4ade80; margin-top: 10px; }

        /* VISUALIZER */
        .slider-container { margin: 20px 0; }
        input[type="range"] { width: 100%; cursor: pointer; }
        .bit-grid { display: grid; grid-template-columns: repeat(35, 1fr); gap: 2px; margin-top: 10px; font-family: monospace; font-size: 0.8rem; }
        .bit { text-align: center; padding: 5px 0; background: var(--bit-off); border-radius: 2px; }
        .bit.on { background: var(--bit-on); color: #064e3b; font-weight: bold; }
        .bit.dot { background: transparent; color: white; font-size: 1.2rem; line-height: 1; }
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 20px; }
        .info-box { background: #0f172a; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #334155; }
        .info-label { font-size: 0.8rem; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px; }
        .info-val { font-size: 1.2rem; font-weight: bold; color: white; margin-top: 5px; }

        /* QUIZ STYLES */
        .question-box { text-align: center; margin-bottom: 30px; }
        .big-ip { font-size: 3rem; font-weight: bold; color: white; margin: 10px 0; text-shadow: 0 0 20px rgba(139, 92, 246, 0.5); }
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 800px; margin: 0 auto; }
        @media(max-width: 600px) { .input-grid { grid-template-columns: 1fr; } }
        
        .field label { display: block; color: #cbd5e1; margin-bottom: 5px; font-size: 0.9rem; }
        .field input { width: 100%; padding: 12px; background: #0f172a; border: 2px solid #334155; border-radius: 6px; color: white; font-family: 'Consolas', monospace; font-size: 1.1rem; box-sizing: border-box; transition: 0.2s; }
        .field input:focus { outline: none; border-color: var(--accent); }
        .field input.correct { border-color: var(--bit-on); background: rgba(16, 185, 129, 0.1); }
        .field input.wrong { border-color: var(--red); background: rgba(239, 68, 68, 0.1); }
        
        .action-btns { text-align: center; margin-top: 30px; display: flex; justify-content: center; gap: 15px; }
        button { border: none; padding: 12px 30px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1rem; transition: 0.2s; }
        .btn-check { background: var(--accent); color: white; }
        .btn-check:hover { background: #7c3aed; transform: scale(1.05); }
        .btn-skip { background: transparent; color: #94a3b8; border: 1px solid #334155; }
        .btn-skip:hover { color: white; border-color: white; }

        .solution-panel { margin-top: 20px; background: #0f172a; padding: 20px; border-radius: 8px; border: 1px solid var(--red); color: #fca5a5; display: none; }
        .solution-line { font-family: monospace; margin: 5px 0; }

    </style>
</head>
<body>

<a href="index.html" class="home-btn">üè† Accueil</a>

<header>
    <h1>üß† Master Subnetting</h1>
    <p>CIDR ‚Ä¢ Binaire ‚Ä¢ Wildcard ‚Ä¢ VLSM</p>
</header>

<div class="container">
    
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('cours')">üìò Cours & M√©thode</button>
        <button class="tab-btn" onclick="switchTab('visu')">üëÅÔ∏è Visualiseur CIDR</button>
        <button class="tab-btn" onclick="switchTab('quiz')">üî• Entra√Ænement</button>
    </div>

    <div id="cours" class="section active">
        <div class="card">
            <h2>La R√®gle Magique de 256</h2>
            <p>Oublie les calculs binaires compliqu√©s. Pour trouver les plages r√©seaux rapidement, utilise la r√®gle du nombre magique.</p>
            
            <div class="magic-rule">
                <h3>La Formule :</h3>
                <p>1. Trouve l'octet "int√©ressant" (celui o√π le masque n'est ni 0, ni 255).</p>
                <p>2. Fais le calcul : <span class="highlight">256 - Masque = Pas (Taille du bloc)</span></p>
            </div>

            <h3>Exemple : 192.168.1.55 /26</h3>
            <p>1. Masque /26 = 255.255.255.<span class="highlight">192</span></p>
            <p>2. Octet int√©ressant : Le dernier (192).</p>
            <p>3. Nombre magique : <strong>256 - 192 = 64</strong>.</p>
            <p>‚ûú Les r√©seaux avancent de 64 en 64 dans le dernier octet :</p>
            <div class="calc-box">
                R√©seau 0 : 192.168.1.0   √† 192.168.1.63<br>
                R√©seau 1 : 192.168.1.64  √† 192.168.1.127<br>
                R√©seau 2 : 192.168.1.128 ...<br><br>
                Notre IP (.55) est entre 0 et 63. Donc R√©seau = .0, Broadcast = .63
            </div>
        </div>

        <div class="card">
            <h2>Wildcard Mask (Masque G√©n√©rique)</h2>
            <p>Utilis√© dans les ACLs Cisco ou OSPF. C'est l'inverse binaire du masque de sous-r√©seau.</p>
            <p><strong>Astuce :</strong> Fais une soustraction avec 255.255.255.255.</p>
            <div class="calc-box" style="color:#fcd34d">
                  255.255.255.255<br>
                - 255.255.255.192 (Masque /26)<br>
                -----------------<br>
                = 0.0.0.63 (Wildcard)
            </div>
        </div>
    </div>

    <div id="visu" class="section">
        <div class="card">
            <h2>Visualiseur CIDR & Binaire</h2>
            <p>Bouge le curseur pour comprendre comment le masque "coupe" l'IP.</p>
            
            <div class="slider-container">
                <input type="range" id="cidrSlider" min="8" max="30" value="24" oninput="updateVisu()">
                <div style="display:flex; justify-content:space-between; margin-top:5px; color:#94a3b8;">
                    <span>/8</span><span>/16</span><span>/24</span><span>/30</span>
                </div>
            </div>

            <div class="info-grid">
                <div class="info-box">
                    <div class="info-label">Notation CIDR</div>
                    <div class="info-val" id="visuCidr">/24</div>
                </div>
                <div class="info-box">
                    <div class="info-label">Masque D√©cimal</div>
                    <div class="info-val" id="visuMask">255.255.255.0</div>
                </div>
                <div class="info-box">
                    <div class="info-label">H√¥tes Totaux</div>
                    <div class="info-val" id="visuHosts">256</div>
                </div>
                 <div class="info-box">
                    <div class="info-label">H√¥tes Utilisables</div>
                    <div class="info-val" id="visuUsable">254</div>
                </div>
            </div>

            <div style="margin-top:20px; font-weight:bold; color:#cbd5e1;">Masque en Binaire :</div>
            <div class="bit-grid" id="bitGrid">
                </div>
            <div style="text-align:center; font-size:0.8rem; color:#64748b; margin-top:5px;">
                <span style="color:#10b981">‚ñ†</span> Bits R√©seau (1) &nbsp;&nbsp; 
                <span style="color:#475569">‚ñ†</span> Bits H√¥te (0)
            </div>
        </div>
    </div>

    <div id="quiz" class="section">
        <div class="card">
            <div class="question-box">
                <span style="color:#94a3b8; text-transform:uppercase; letter-spacing:1px; font-size:0.9rem;">Analyse l'adresse suivante</span>
                <div class="big-ip" id="qIP">192.168.1.10 / 24</div>
            </div>

            <div class="input-grid">
                <div class="field">
                    <label>Adresse R√©seau (Network ID)</label>
                    <input type="text" id="ansNet" placeholder="Ex: 192.168.1.0">
                </div>
                <div class="field">
                    <label>Masque (Wildcard)</label>
                    <input type="text" id="ansWild" placeholder="Ex: 0.0.0.255">
                </div>
                <div class="field">
                    <label>Premi√®re IP Utilisable</label>
                    <input type="text" id="ansFirst">
                </div>
                <div class="field">
                    <label>Derni√®re IP Utilisable</label>
                    <input type="text" id="ansLast">
                </div>
                <div class="field" style="grid-column: 1 / -1;">
                    <label>Adresse de Diffusion (Broadcast)</label>
                    <input type="text" id="ansBroad">
                </div>
            </div>

            <div class="solution-panel" id="solution">
                <strong>‚ùå R√©ponses attendues :</strong><br>
                <div id="solContent"></div>
            </div>

            <div class="action-btns">
                <button class="btn-skip" onclick="generateQuestion()">Passer / Nouveau</button>
                <button class="btn-check" onclick="checkAnswer()">V√©rifier</button>
            </div>
        </div>
        
        <div style="text-align:center; color:#64748b; font-size:0.9rem;">
            Score : <span id="scoreVal" style="color:white; font-weight:bold;">0</span> r√©ussites
        </div>
    </div>

</div>

<script>
/* ========================
   LOGIC: IP MATHS
   ======================== */

// Convertit IP (string) en Entier 32 bits
function ipToInt(ip) {
    return ip.split('.').reduce((acc, octet) => (acc << 8) + parseInt(octet, 10), 0) >>> 0;
}

// Convertit Entier 32 bits en IP (string)
function intToIp(int) {
    return [
        (int >>> 24) & 255,
        (int >>> 16) & 255,
        (int >>> 8) & 255,
        int & 255
    ].join('.');
}

// Cr√©e un masque binaire depuis CIDR
function getMask(cidr) {
    return (0xFFFFFFFF << (32 - cidr)) >>> 0;
}

// Wildcard = Inverse du masque
function getWildcard(maskInt) {
    return (~maskInt >>> 0) & 0xFFFFFFFF; // Ensure unsigned
}

/* ========================
   LOGIC: VISUALIZER
   ======================== */
function updateVisu() {
    const cidr = parseInt(document.getElementById('cidrSlider').value);
    
    // MAJ Textes
    document.getElementById('visuCidr').innerText = "/" + cidr;
    const maskInt = getMask(cidr);
    document.getElementById('visuMask').innerText = intToIp(maskInt);
    
    const totalHosts = Math.pow(2, 32 - cidr);
    document.getElementById('visuHosts').innerText = totalHosts.toLocaleString();
    document.getElementById('visuUsable').innerText = (totalHosts > 2 ? totalHosts - 2 : 0).toLocaleString();

    // MAJ Grille Bits
    const grid = document.getElementById('bitGrid');
    grid.innerHTML = "";
    
    let binaryStr = "";
    for(let i=0; i<32; i++) {
        const isNetwork = i < cidr;
        const bitClass = isNetwork ? "bit on" : "bit";
        const val = isNetwork ? "1" : "0";
        
        const el = document.createElement('div');
        el.className = bitClass;
        el.innerText = val;
        grid.appendChild(el);

        // Ajout des points s√©parateurs
        if ((i+1) % 8 === 0 && i !== 31) {
            const dot = document.createElement('div');
            dot.className = "bit dot";
            dot.innerText = ".";
            grid.appendChild(dot);
        }
    }
}

/* ========================
   LOGIC: QUIZ
   ======================== */
let currentQ = {};
let score = 0;

function generateQuestion() {
    // Reset UI
    document.getElementById('solution').style.display = 'none';
    ['ansNet', 'ansWild', 'ansFirst', 'ansLast', 'ansBroad'].forEach(id => {
        const el = document.getElementById(id);
        el.value = '';
        el.className = '';
    });

    // Random CIDR (Focus on /24 to /30 for practice, but allow /8 to /23 sometimes)
    // 70% chance of /24-/30, 30% chance of /8-/23
    let cidr;
    if(Math.random() > 0.3) cidr = Math.floor(Math.random() * (30 - 24 + 1) + 24);
    else cidr = Math.floor(Math.random() * (23 - 8 + 1) + 8);

    // Random IP
    const randIpInt = Math.floor(Math.random() * 0xFFFFFFFF) >>> 0;
    
    // Calc solutions
    const mask = getMask(cidr);
    const netAddr = (randIpInt & mask) >>> 0;
    const broadAddr = (netAddr | (~mask)) >>> 0;
    const first = (netAddr + 1) >>> 0;
    const last = (broadAddr - 1) >>> 0;
    const wildcard = getWildcard(mask);

    // Choose a random host inside for the display
    // We display an IP inside the subnet, user finds the subnet ID
    const displayIpInt = Math.floor(Math.random() * (last - first + 1)) + first;
    
    currentQ = {
        cidr: cidr,
        display: `${intToIp(displayIpInt)} / ${cidr}`,
        net: intToIp(netAddr),
        broad: intToIp(broadAddr),
        first: intToIp(first),
        last: intToIp(last),
        wild: intToIp(wildcard)
    };

    document.getElementById('qIP').innerText = currentQ.display;
}

function checkAnswer() {
    const getVal = id => document.getElementById(id).value.trim();
    const setClass = (id, correct) => {
        const el = document.getElementById(id);
        el.className = correct ? 'correct' : 'wrong';
        return correct;
    };

    let allGood = true;
    allGood &= setClass('ansNet', getVal('ansNet') === currentQ.net);
    allGood &= setClass('ansBroad', getVal('ansBroad') === currentQ.broad);
    allGood &= setClass('ansFirst', getVal('ansFirst') === currentQ.first);
    allGood &= setClass('ansLast', getVal('ansLast') === currentQ.last);
    allGood &= setClass('ansWild', getVal('ansWild') === currentQ.wild);

    if (allGood) {
        score++;
        document.getElementById('scoreVal').innerText = score;
        // Confetti ou petit d√©lai puis next ?
        setTimeout(() => {
            if(confirm("Bravo ! Correct. Question suivante ?")) generateQuestion();
        }, 200);
    } else {
        const sol = document.getElementById('solution');
        const solContent = document.getElementById('solContent');
        sol.style.display = 'block';
        solContent.innerHTML = `
            <div class="solution-line">R√©seau   : ${currentQ.net}</div>
            <div class="solution-line">Wildcard : ${currentQ.wild}</div>
            <div class="solution-line">1√®re IP  : ${currentQ.first}</div>
            <div class="solution-line">Derni√®re : ${currentQ.last}</div>
            <div class="solution-line">Broadcast: ${currentQ.broad}</div>
        `;
    }
}

/* ========================
   UI UTILS
   ======================== */
function switchTab(id) {
    document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    
    document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
    // Simple hack to find button clicked without passing 'this'
    const index = ['cours','visu','quiz'].indexOf(id);
    document.querySelectorAll('.tab-btn')[index].classList.add('active');
}

// Init
updateVisu();
generateQuestion();

</script>
</body>
</html>